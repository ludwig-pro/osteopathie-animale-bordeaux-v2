---
export interface Props {
  title: string;
  description?: string;
  siteUrl?: string;
}

const { title, description = "L'Ost√©opathe animalier Agathe Lescout, intervenant sur Bordeaux et Gironde!", siteUrl = 'https://www.osteopathie-animale-bordeaux.fr' } = Astro.props;
const posthogKey = import.meta.env.PUBLIC_POSTHOG_KEY;
const posthogHost = import.meta.env.PUBLIC_POSTHOG_HOST ?? 'https://us.i.posthog.com';
const isPostHogEnabled = Boolean(posthogKey);
---

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={siteUrl} />
    <meta name="theme-color" content="#c0823f" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- Preconnect to third-party domains for faster loading -->
    <link rel="preconnect" href="https://api.mapbox.com" />
    <link rel="preconnect" href="https://www.google.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://calendly.com" />
    {isPostHogEnabled && <link rel="preconnect" href={posthogHost} />}

    <script is:inline>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-KCM49LQ');
    </script>
    {isPostHogEnabled && (
      <script is:inline define:vars={{ posthogKey, posthogHost }}>
        !function(t,e){
          var o,n,p,r;
          if(e.__posthog_initialized__) return;
          e.__posthog_initialized__ = true;
          e.posthog = e.posthog || [];
          e.posthog.__SV = 1;
          o=t.createElement("script");
          o.type="text/javascript";
          o.async=!0;
          o.src=posthogHost.replace(".i.posthog.com","-assets.i.posthog.com") + "/static/array.js";
          n=t.getElementsByTagName("script")[0];
          n.parentNode.insertBefore(o,n);
          p=function(t,o){
            var n=o.split(".");
            n.length===2 && (t[n[0]] = t[n[0]] || [], t=t[n[0]], o=n[1]);
            t[o]=function(){
              t.push([o].concat(Array.prototype.slice.call(arguments,0)));
            };
          };
          r=e.posthog;
          r.people = r.people || [];
          ["init","capture","identify","alias","people.set","set_config"].forEach(function(t){p(r,t);});
          e.dataLayer = e.dataLayer || [];
          var ignored = {"gtm.js": true, "gtm.dom": true, "gtm.load": true};
          var mirrorDataLayerItem = function(item){
            if(!item || typeof item !== "object") return;
            var eventName = item.event;
            if(typeof eventName !== "string" || ignored[eventName]) return;
            var props = {};
            for (var key in item) {
              if (Object.prototype.hasOwnProperty.call(item, key) && key !== "event") {
                props[key] = item[key];
              }
            }
            e.posthog.capture(eventName, props);
          };
          e.dataLayer.forEach(mirrorDataLayerItem);
          var originalPush = e.dataLayer.push.bind(e.dataLayer);
          e.dataLayer.push = function() {
            var items = Array.prototype.slice.call(arguments, 0);
            items.forEach(mirrorDataLayerItem);
            return originalPush.apply(e.dataLayer, items);
          };
          e.posthog.init(posthogKey, {
            api_host: posthogHost,
            defaults: "2026-01-30",
            autocapture: true,
            capture_pageview: true,
            capture_pageleave: true,
            disable_session_recording: true,
            capture_dead_clicks: false,
            rageclick: false,
          });
        }(document, window);
      </script>
    )}
  </head>
  <body>
    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KCM49LQ" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <slot />
  </body>
</html>
